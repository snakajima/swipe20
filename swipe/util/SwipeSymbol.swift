//
//  SwipeSymbol.swift
//  swipe_dev
//
//  Created by SATOSHI NAKAJIMA on 10/4/20.
//

import SwiftUI
import CoreGraphics
#if os(macOS)
    import AppKit
    public typealias OSFont = NSFont
#elseif os(iOS) || os(tvOS)
    import UIKit
    public typealias OSFont = UIFont
#endif

let s_trash:[String:Any] = [
    "path":"M 46.4844 32.4707 L 104.98 32.4707 C 116.895 32.4707 123.926 26.3672 124.463 14.3555 L 128.369 -73.1445 L 133.105 -73.1445 C 138.086 -73.1445 141.748 -76.6113 141.748 -81.5918 C 141.748 -86.4746 138.086 -89.8926 133.105 -89.8926 L 107.666 -89.8926 L 107.666 -98.584 C 107.666 -110.059 100.635 -116.309 87.6465 -116.309 L 63.7207 -116.309 C 50.7324 -116.309 43.7012 -110.059 43.7012 -98.584 L 43.7012 -89.8926 L 18.3105 -89.8926 C 13.3301 -89.8926 9.66797 -86.4746 9.66797 -81.5918 C 9.66797 -76.6113 13.3301 -73.1445 18.3105 -73.1445 L 23.0469 -73.1445 L 26.9531 14.3555 C 27.4902 26.416 34.4727 32.4707 46.4844 32.4707 Z M 61.1816 -98.1445 C 61.1816 -100.195 62.6465 -101.465 65.0879 -101.465 L 86.2793 -101.465 C 88.7207 -101.465 90.1855 -100.195 90.1855 -98.1445 L 90.1855 -89.8926 L 61.1816 -89.8926 Z M 49.0234 15.3809 C 45.9473 15.3809 44.2383 13.3789 44.0918 9.66797 L 40.2832 -73.1445 L 111.035 -73.1445 L 107.324 9.66797 C 107.178 13.3789 105.518 15.3809 102.393 15.3809 Z M 57.4707 7.4707 C 61.1328 7.4707 63.4277 5.12695 63.2812 1.66016 L 61.4746 -59.375 C 61.377 -62.7441 59.0332 -65.0391 55.4688 -65.0391 C 51.9531 -65.0391 49.707 -62.7441 49.8535 -59.2773 L 51.6602 1.80664 C 51.8066 5.17578 54.1504 7.4707 57.4707 7.4707 Z M 75.7324 7.4707 C 79.1504 7.4707 81.4941 5.22461 81.4941 1.85547 L 81.4941 -59.4238 C 81.4941 -62.793 79.1504 -65.0391 75.7324 -65.0391 C 72.2656 -65.0391 69.9219 -62.793 69.9219 -59.4238 L 69.9219 1.85547 C 69.9219 5.22461 72.2656 7.4707 75.7324 7.4707 Z M 93.9453 7.4707 C 97.2656 7.4707 99.6094 5.17578 99.7559 1.80664 L 101.562 -59.2773 C 101.709 -62.7441 99.4629 -65.0391 95.9473 -65.0391 C 92.4316 -65.0391 90.0391 -62.7441 89.9414 -59.375 L 88.1348 1.66016 C 87.9883 5.12695 90.2832 7.4707 93.9453 7.4707 Z"
]

let s_gearshape:[String:Any] = [
    "path":"M 76.8066 36.7188 L 89.7461 36.7188 C 96.2891 36.7188 101.611 32.5195 103.027 26.3672 L 105.127 17.4316 L 105.42 17.334 L 113.232 22.1191 C 118.701 25.4395 125.391 24.5117 129.932 19.873 L 138.867 11.0352 C 143.506 6.20117 144.287 -0.390625 140.967 -5.66406 L 136.182 -13.3789 L 136.279 -13.6719 L 145.068 -15.7715 C 151.172 -17.334 155.322 -22.6562 155.322 -29.0527 L 155.322 -41.3574 C 155.322 -47.7539 151.221 -53.125 145.068 -54.6387 L 136.328 -56.7871 L 136.182 -57.0801 L 140.967 -64.7949 C 144.336 -70.1172 143.506 -76.6602 138.867 -81.4941 L 129.932 -90.3809 C 125.439 -95.0195 118.75 -95.9473 113.281 -92.627 L 105.469 -87.8418 L 105.127 -87.9883 L 103.027 -96.9238 C 101.611 -103.076 96.2891 -107.275 89.7461 -107.275 L 76.8066 -107.275 C 70.3125 -107.275 64.9902 -102.979 63.5254 -96.9238 L 61.4746 -87.9883 L 61.084 -87.8418 L 53.2715 -92.627 C 47.8516 -95.8984 41.1621 -95.0195 36.6699 -90.3809 L 27.7344 -81.4941 C 23.0957 -76.6602 22.2168 -70.1172 25.6348 -64.7949 L 30.4199 -57.0801 L 30.2734 -56.7871 L 21.4844 -54.6387 C 15.332 -53.0762 11.2793 -47.7539 11.2793 -41.3574 L 11.2793 -29.0527 C 11.2793 -22.6562 15.3809 -17.2852 21.4844 -15.7715 L 30.3223 -13.6719 L 30.4199 -13.3789 L 25.6348 -5.66406 C 22.2656 -0.390625 23.0957 6.20117 27.7344 11.0352 L 36.6699 19.873 C 41.2109 24.5117 47.9004 25.4395 53.3203 22.1191 L 61.1328 17.334 L 61.4746 17.4316 L 63.5254 26.3672 C 64.9902 32.5195 70.3125 36.7188 76.8066 36.7188 Z M 80.2734 19.5312 C 79.3457 19.5312 78.9551 19.043 78.8086 18.2617 L 75.1953 3.07617 C 70.6055 2.24609 65.9668 0.292969 61.7188 -2.53906 L 48.3398 5.61523 C 47.7051 6.05469 47.0215 6.05469 46.3867 5.46875 L 42.1875 1.26953 C 41.5039 0.634766 41.6504 -0.0488281 41.9922 -0.683594 L 50.293 -14.0625 C 47.6074 -18.3105 45.7031 -22.8027 44.873 -27.2949 L 29.6875 -30.8594 C 28.9062 -31.0059 28.418 -31.3965 28.418 -32.373 L 28.418 -38.0859 C 28.418 -39.0625 28.9062 -39.4043 29.6875 -39.5508 L 44.873 -43.1152 C 45.8008 -47.7051 47.6074 -52.3438 50.2441 -56.4453 L 41.9922 -69.8242 C 41.6016 -70.459 41.4551 -71.0938 42.1387 -71.7773 L 46.3867 -75.9277 C 47.0215 -76.5137 47.6074 -76.5625 48.3398 -76.123 L 61.6699 -67.9688 C 64.9902 -70.3613 70.3125 -72.6074 75.1953 -73.6328 L 78.8086 -88.8184 C 78.9551 -89.5996 79.3457 -90.0391 80.2734 -90.0391 L 86.2793 -90.0391 C 87.2559 -90.0391 87.6465 -89.5996 87.793 -88.8184 L 91.4062 -73.584 C 96.1914 -72.6562 100.83 -70.6543 104.932 -67.9688 L 118.115 -75.9766 C 118.848 -76.416 119.385 -76.4648 120.068 -75.8301 L 124.365 -71.6797 C 125 -70.9961 124.902 -70.3613 124.463 -69.6777 L 116.309 -56.4453 C 118.945 -52.3926 120.801 -47.7051 121.68 -43.2129 L 136.914 -39.5508 C 137.695 -39.4043 138.135 -39.0625 138.135 -38.0859 L 138.135 -32.373 C 138.135 -31.3965 137.695 -31.0059 136.914 -30.8594 L 121.631 -27.2461 C 120.85 -22.8516 118.945 -18.1152 116.26 -14.0625 L 124.463 -0.78125 C 124.854 -0.146484 124.951 0.488281 124.316 1.12305 L 120.068 5.32227 C 119.385 6.00586 118.799 5.95703 118.115 5.51758 L 104.932 -2.53906 C 100.488 0.292969 96.5332 2.09961 91.4062 3.07617 L 87.793 18.2617 C 87.6465 19.043 87.2559 19.5312 86.2793 19.5312 Z M 83.3008 -11.6699 C 96.1914 -11.6699 106.787 -22.3145 106.787 -35.2539 C 106.787 -48.1445 96.1914 -58.6914 83.3008 -58.6914 C 70.3613 -58.6914 59.7168 -48.1445 59.7168 -35.2539 C 59.7168 -22.2656 70.3613 -11.6699 83.3008 -11.6699 Z M 83.3008 -26.416 C 78.4668 -26.416 74.5117 -30.4199 74.5117 -35.2539 C 74.5117 -40.0391 78.5156 -43.9453 83.3008 -43.9453 C 87.9883 -43.9453 91.8945 -39.9902 91.8945 -35.2539 C 91.8945 -30.4199 87.9883 -26.416 83.3008 -26.416 Z"
]

let s_plus:[String:Any] = [
    "path":"M 71.2891 20.3125 C 77.832 20.3125 83.3496 14.5508 83.3496 8.54492 L 83.3496 -23.0957 L 114.648 -23.0957 C 120.947 -23.0957 126.465 -28.6133 126.465 -35.2051 C 126.465 -41.748 120.947 -47.2656 114.648 -47.2656 L 83.3496 -47.2656 L 83.3496 -78.8574 C 83.3496 -85.1562 77.832 -90.6738 71.2891 -90.6738 C 64.6973 -90.6738 59.1797 -85.1562 59.1797 -78.8574 L 59.1797 -47.2656 L 27.8809 -47.2656 C 21.875 -47.2656 16.0645 -41.748 16.0645 -35.2051 C 16.0645 -28.6133 21.875 -23.0957 27.8809 -23.0957 L 59.1797 -23.0957 L 59.1797 8.54492 C 59.1797 14.5508 64.6973 20.3125 71.2891 20.3125 Z"
]

let s_backward:[String:Any] = [
    "path":"M 75.5371 26.3672 C 82.4707 26.3672 87.7441 21.0938 87.7441 14.209 L 87.7441 -3.71094 L 88.4277 -3.71094 C 106.982 -3.71094 116.846 4.6875 123.535 16.6016 C 127.1 22.9004 130.811 25.1953 136.035 25.1953 C 143.701 25.1953 147.998 17.5293 147.998 1.9043 C 147.998 -40.9668 127.002 -66.2598 88.4277 -66.2598 L 87.7441 -66.2598 L 87.7441 -84.4727 C 87.7441 -91.4062 82.4707 -96.8262 75.4883 -96.8262 C 71.2402 -96.8262 67.9688 -95.2148 63.2812 -90.9668 L 12.793 -44.3848 C 10.2051 -41.9434 8.83789 -38.4766 8.83789 -35.2051 C 8.83789 -32.1777 10.2539 -28.418 12.8418 -25.9766 L 63.2812 20.6543 C 67.5781 24.6582 71.0449 26.3672 75.5371 26.3672 Z M 70.2148 1.36719 C 69.9219 1.36719 69.5801 1.17188 69.2871 0.878906 L 31.9824 -34.2773 C 31.5918 -34.668 31.4453 -34.9121 31.4453 -35.2051 C 31.4453 -35.5469 31.5918 -35.791 31.9824 -36.1816 L 69.2871 -71.4844 C 69.5801 -71.7285 69.9219 -71.8262 70.2148 -71.8262 C 70.8008 -71.8262 71.3379 -71.3867 71.3379 -70.6543 L 71.3379 -50.7812 C 71.3379 -49.3652 71.9238 -48.7305 73.3398 -48.7305 L 80.4688 -48.7305 C 113.867 -48.7305 130.957 -30.6641 131.396 -1.07422 C 131.396 -0.732422 131.201 -0.585938 131.006 -0.585938 C 130.762 -0.585938 130.664 -0.683594 130.469 -1.02539 C 122.852 -16.2109 106.299 -21.6797 80.4688 -21.6797 L 73.3398 -21.6797 C 71.9238 -21.6797 71.3379 -21.0938 71.3379 -19.6777 L 71.3379 0.146484 C 71.3379 0.830078 70.8008 1.36719 70.2148 1.36719 Z"
]
let s_forward:[String:Any] = [
    "path":"M 87.7441 26.3672 C 92.2363 26.3672 95.7031 24.6582 100 20.6543 L 150.439 -25.9766 C 153.027 -28.418 154.443 -32.1777 154.443 -35.2051 C 154.443 -38.4766 153.076 -41.9434 150.537 -44.3848 L 100 -90.9668 C 95.3125 -95.2148 92.0898 -96.8262 87.793 -96.8262 C 80.8594 -96.8262 75.5371 -91.4062 75.5371 -84.4727 L 75.5371 -66.2598 L 74.9023 -66.2598 C 36.2793 -66.2598 15.2832 -40.9668 15.2832 1.9043 C 15.2832 17.5293 19.5801 25.1953 27.2461 25.1953 C 32.4707 25.1953 36.4258 22.998 39.7461 16.6016 C 46.4844 4.6875 56.2988 -3.71094 74.9023 -3.71094 L 75.5371 -3.71094 L 75.5371 14.209 C 75.5371 21.0938 80.8594 26.3672 87.7441 26.3672 Z M 93.0664 1.36719 C 92.4805 1.36719 91.9922 0.830078 91.9922 0.146484 L 91.9922 -19.6777 C 91.9922 -21.0938 91.3574 -21.6797 89.9414 -21.6797 L 82.8125 -21.6797 C 56.9824 -21.6797 40.7715 -16.0156 32.8125 -1.02539 C 32.666 -0.683594 32.5195 -0.585938 32.2754 -0.585938 C 32.0801 -0.585938 31.9336 -0.732422 31.9336 -1.07422 C 32.373 -30.6641 49.4141 -48.7305 82.8125 -48.7305 L 89.9414 -48.7305 C 91.3574 -48.7305 91.9922 -49.3652 91.9922 -50.7812 L 91.9922 -70.6543 C 91.9922 -71.3867 92.4805 -71.8262 93.0664 -71.8262 C 93.4082 -71.8262 93.7012 -71.7285 93.9941 -71.4844 L 131.299 -36.1816 C 131.689 -35.791 131.836 -35.5469 131.836 -35.2051 C 131.836 -34.9121 131.689 -34.668 131.299 -34.2773 L 93.9941 0.878906 C 93.7012 1.17188 93.4082 1.36719 93.0664 1.36719 Z"
]

let s_duplicate:[String:Any] = [
    "path":"M 39.9902 5.07812 L 50.1465 5.07812 L 50.1465 14.1602 C 50.1465 29.3457 58.7891 37.9883 74.0234 37.9883 L 139.697 37.9883 C 154.932 37.9883 163.574 29.3457 163.574 14.1602 L 163.574 -51.6602 C 163.574 -66.8457 154.932 -75.4883 139.697 -75.4883 L 129.541 -75.4883 L 129.541 -84.5703 C 129.541 -99.7559 120.85 -108.35 105.615 -108.35 L 39.9902 -108.35 C 24.707 -108.35 16.0645 -99.7559 16.0645 -84.5703 L 16.0645 -18.7012 C 16.0645 -3.51562 24.707 5.07812 39.9902 5.07812 Z M 42.6758 -15.1367 C 38.4766 -15.1367 36.3281 -17.041 36.3281 -21.582 L 36.3281 -81.6895 C 36.3281 -86.2305 38.4766 -88.1348 42.6758 -88.1348 L 102.881 -88.1348 C 107.129 -88.1348 109.277 -86.2305 109.277 -81.6895 L 109.277 -75.4883 L 74.0234 -75.4883 C 58.7891 -75.4883 50.1465 -66.8457 50.1465 -51.6602 L 50.1465 -15.1367 Z M 76.7578 17.7734 C 72.5098 17.7734 70.3613 15.8691 70.3613 11.3281 L 70.3613 -48.7793 C 70.3613 -53.3691 72.5098 -55.2246 76.7578 -55.2246 L 136.963 -55.2246 C 141.211 -55.2246 143.359 -53.3691 143.359 -48.7793 L 143.359 11.3281 C 143.359 15.8691 141.211 17.7734 136.963 17.7734 Z"
]

let s_scribble:[String:Any] = [
    "path":"M 15.4785 -17.334 C 19.0918 -13.623 24.7559 -13.6719 28.418 -17.334 L 39.502 -28.418 C 83.2031 -72.1191 98.1445 -85.4492 101.758 -81.9336 C 104.688 -79.0039 95.2148 -68.9453 77.5391 -48.1445 C 60.1562 -27.6855 38.623 -3.66211 54.3457 12.1094 C 68.7988 26.6602 90.7715 7.56836 106.592 -7.4707 C 116.455 -16.7969 121.68 -21.4844 124.121 -23.7305 C 122.754 -22.2168 120.703 -19.6289 118.262 -15.332 C 112.256 -4.98047 103.76 10.1562 113.672 20.0684 C 121.24 27.6367 132.861 24.0234 146.484 10.4004 C 150.488 6.34766 150.781 0.683594 147.021 -3.02734 C 143.408 -6.54297 137.939 -6.5918 134.229 -3.125 C 132.861 -1.9043 131.543 -0.585938 130.273 0.683594 C 131.494 -1.12305 132.764 -3.125 133.887 -5.0293 C 143.994 -21.9238 146.045 -31.3965 139.16 -38.2324 C 130.469 -46.875 116.553 -42.041 93.75 -20.6543 C 78.4668 -6.39648 69.0918 0.830078 67.2363 -1.02539 C 65.332 -2.92969 72.7051 -14.7949 91.3086 -36.2305 C 119.238 -68.5059 126.514 -83.0078 114.6 -94.8242 C 99.707 -109.668 85.0586 -99.7559 26.6113 -41.3086 L 15.5273 -30.2246 C 11.9629 -26.6113 11.9629 -20.9961 15.4785 -17.334 Z"
]

let s_checkmark:[String:Any] = [
    "path":"M 64.3066 23.0469 C 69.6289 23.0469 73.7793 21.0938 76.6602 16.8945 L 134.57 -70.3613 C 136.572 -73.3398 137.402 -76.3184 137.402 -79.0039 C 137.402 -86.4746 131.641 -91.9922 123.975 -91.9922 C 118.75 -91.9922 115.43 -90.1367 112.256 -85.1562 L 64.0625 -9.375 L 39.7949 -38.5254 C 37.0117 -41.8457 33.7891 -43.3105 29.4434 -43.3105 C 21.7285 -43.3105 16.0645 -37.7441 16.0645 -30.2246 C 16.0645 -26.8555 17.041 -24.0234 19.9219 -20.7031 L 52.4414 17.6758 C 55.6641 21.3867 59.4238 23.0469 64.3066 23.0469 Z"
]

let template:[String:Any] = [
    "path":""
]

struct SwipeSymbol: View {
    //let script:[String:Any]
    let path:CGPath
    let bound:CGRect
    static let emtyPath = CGPath(rect: .zero, transform: nil)
    init(script:[String:Any]) {
        path = SwipePath.parse(script["path"]) ?? Self.emtyPath
        bound = path.boundingBoxOfPath
    }
    func scaleToFit(_ size:CGSize) -> CGFloat {
        return min(size.height / bound.height, size.width / bound.width) * 0.8
    }
    public var body: some View {
        GeometryReader { geometry in
            let scale = scaleToFit(geometry.size)
            var xf = CGAffineTransform(scaleX: scale, y: scale)
            Path(path.copy(using: &xf) ?? Self.emtyPath)
        }.alignmentGuide(.firstTextBaseline, computeValue: { d in
            return 0
        }).alignmentGuide(VerticalAlignment.center, computeValue: { d in
            let scale = scaleToFit(CGSize(width: d.width, height: d.height))
            return scale * (bound.maxY - bound.height / 2)
        })
    }
}

extension SwipeSymbol {
    static var trash:SwipeSymbol {
        return SwipeSymbol(script: s_trash)
    }
    static var gearshape:SwipeSymbol {
        return SwipeSymbol(script: s_gearshape)
    }
    static var plus:SwipeSymbol {
        return SwipeSymbol(script: s_plus)
    }
    static var backward:SwipeSymbol {
        return SwipeSymbol(script: s_backward)
    }
    static var forward:SwipeSymbol {
        return SwipeSymbol(script: s_forward)
    }
    static var duplicate:SwipeSymbol {
        return SwipeSymbol(script: s_duplicate)
    }
    static var scribble:SwipeSymbol {
        return SwipeSymbol(script: s_scribble)
    }
    static var checkmark:SwipeSymbol {
        return SwipeSymbol(script: s_checkmark)
    }
}

struct SwipeSymbol_Previews: PreviewProvider {
    static let bigFont = OSFont.systemFont(ofSize: 70)
    static let smallFont = OSFont.systemFont(ofSize: 24)
    static var previews: some View {
        VStack {
            Text("Hello")
            HStack(alignment: .center, spacing: 0) {
                Text("Hello")
                Rectangle().frame(width:70, height:70)
                SwipeSymbol.trash.frame(width:70, height:70)
                SwipeSymbol.backward.frame(width:70, height:70)
                SwipeSymbol.forward.frame(width:70, height:70)
            }
            HStack(alignment: .firstTextBaseline, spacing: 0) {
                Text("Hello")
                Rectangle().frame(width:70, height:70)
                SwipeSymbol.trash.frame(width:70, height:70)
                Text("Hello").font(Font(bigFont))
            }
            HStack(alignment: .bottom, spacing: 0) {
                Text("Hello")
                Rectangle().frame(width:70, height:70)
                SwipeSymbol.trash.frame(width:70, height:70)
                Text("Hello").font(Font(bigFont))
            }
            Text("Hello")
        }
    }
}
